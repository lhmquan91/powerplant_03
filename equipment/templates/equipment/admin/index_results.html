{# area/templates/area/admin/index_results.html #}
{% extends "wagtailadmin/generic/listing_results.html" %}
{% load i18n wagtailadmin_tags wagtailimages_tags l10n %}

{% block results %}
    
    {% if view_mode == 'grid' %}
        {# === GRID VIEW (Horizontal Cards) === #}
        <div class="w-px-4 w-pb-10">
            {% if object_list %}
                {# Toolbar Select All #}
                <div class="w-mb-4 w-flex w-items-center">
                     <label class="w-flex w-items-center w-cursor-pointer w-text-text-label hover:w-text-text-link-hover">
                        {% include 'wagtailadmin/bulk_actions/select_all_checkbox_input.html' with parent=None %}
                        <span class="w-label-3 w-font-bold w-ml-2">{% trans "Chọn tất cả" %}</span>
                    </label>
                </div>

                <div class="w-grid w-grid-cols-1 md:w-grid-cols-3 lg:w-grid-cols-5 w-gap-4">
                    {% for object in object_list %}
                        <div class="w-bg-surface-page w-border w-border-border-furniture w-rounded w-overflow-hidden w-shadow hover:w-shadow-md w-transition-all w-duration-200 w-relative group w-flex w-flex-row w-h-28">
                            
                            {# Cột trái: Ảnh #}
                            <div class="w-w-28 w-bg-grey-100 w-relative w-flex-shrink-0 w-border-r w-border-border-furniture">
                                <div class="w-absolute w-top-1 w-left-1 w-z-20" onclick="event.stopPropagation()">
                                    <input type="checkbox" class="bulk-action-checkbox w-form-checkbox w-w-4 w-h-4" 
                                           data-bulk-action-checkbox data-object-id="{{ object.pk|unlocalize|admin_urlquote }}" aria-label="{% trans 'Select' %}">
                                </div>
                                <div class="w-w-full w-h-full w-flex w-items-center w-justify-center w-overflow-hidden">
                                    {% if object.image %}
                                        {% image object.image fill-200x200 as img %}
                                        <img src="{{ img.url }}" class="w-w-full w-h-full w-object-cover group-hover:w-scale-110 w-transition-transform">
                                    {% else %}
                                        <svg class="icon icon-site w-w-8 w-h-8 w-text-grey-400" aria-hidden="true"><use href="#icon-site"></use></svg>
                                    {% endif %}
                                </div>
                                <a href="{% url 'wagtailsnippets_area_functionallocation:inspect' object.id %}" class="w-absolute w-inset-0"></a>
                                {% if object.kks_code %}
                                    <span class="w-absolute w-bottom-0 w-right-0 w-px-1.5 w-py-0.5 w-text-11 w-font-bold w-bg-surface-menus w-text-text-label w-opacity-90 w-rounded-tl">{{ object.kks_code }}</span>
                                {% endif %}
                            </div>

                            {# Cột phải: Thông tin #}
                            <div class="w-flex-1 w-p-2 w-flex w-flex-col w-justify-between w-min-w-0">
                                <div>
                                    <h3 class="w-h5 w-text-14 w-leading-tight w-mb-1 w-truncate" title="{{ object.name }}">
                                        <a href="{% url 'wagtailsnippets_area_functionallocation:inspect' object.id %}" class="w-text-text-label hover:w-text-text-link-hover">{{ object.name }}</a>
                                    </h3>
                                    <div class="w-text-11 w-text-text-meta w-font-mono">ID: {{ object.pk }}</div>
                                </div>
                                <div class="w-flex w-justify-between w-items-end w-mt-1">
                                    <div class="w-text-12 w-text-text-meta w-truncate w-mr-1">
                                        {% if object.get_parent %}
                                            <span title="{{ object.get_parent.name }}">↳ {{ object.get_parent.name }}</span>
                                        {% else %}
                                            <span class="w-text-critical-200 w-font-bold">ROOT</span>
                                        {% endif %}
                                    </div>
                                    <div class="w-flex-shrink-0">{{ object.audio_status_display }}</div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    {% else %}
        {# === LIST VIEW (Native Table) === #}
        <div class="w-overflow-x-auto">
            {% component table %}
        </div>
    {% endif %}

{% endblock %}

{# Thông báo khi không có kết quả #}
{% block no_results_message %}
    {% if is_searching or is_filtering %}
        <div class="nice-padding">
            <h2>{% blocktrans trimmed with counter=items_count|intcomma %}Tìm thấy {{ counter }} kết quả{% endblocktrans %}</h2>
            <p>{% trans "Không tìm thấy khu vực nào khớp với bộ lọc." %}</p>
        </div>
    {% else %}
        <div class="nice-padding w-mt-8 w-text-center">
            <svg class="icon icon-site w-w-16 w-h-16 w-text-grey-300 w-mb-4" aria-hidden="true"><use href="#icon-site"></use></svg>
            <h3 class="w-h4">{% trans "Chưa có dữ liệu Khu vực" %}</h3>
            {% if add_url %}
                <a href="{{ add_url }}" class="button button-primary w-mt-4">{% trans "Thêm Khu vực mới" %}</a>
            {% endif %}
        </div>
    {% endif %}
{% endblock %}

{# Phân trang #}
{% block pagination %}
    {% if is_paginated %}
        <div class="nice-padding">
            {# linkurl=index_url RẤT QUAN TRỌNG để AJAX biết URL nào để gọi #}
            {% include "wagtailadmin/shared/pagination_nav.html" with items=page_obj linkurl=index_url link_params="view="|add:view_mode %}
        </div>
    {% endif %}
{% endblock %}